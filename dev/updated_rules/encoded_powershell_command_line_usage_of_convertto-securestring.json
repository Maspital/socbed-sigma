[
    {
        "group": "Sigma",
        "kind": "individual",
        "document": {
            "kind": "jsonl",
            "data": {
                "@timestamp": "2022-09-27T12:24:53.543Z",
                "agent": {
                    "ephemeral_id": "f3e67ec5-847a-448b-8ec4-bac040a44990",
                    "hostname": "CLIENT1",
                    "id": "cd699c72-0f46-4cd9-938a-43faf035a44a",
                    "name": "CLIENT1",
                    "type": "winlogbeat",
                    "version": "7.10.2"
                },
                "ecs": {
                    "version": "1.5.0"
                },
                "event": {
                    "action": "Process Create (rule: ProcessCreate)",
                    "category": [
                        "process"
                    ],
                    "code": 1,
                    "created": "2022-09-27T12:27:28.295Z",
                    "kind": "event",
                    "module": "sysmon",
                    "provider": "Microsoft-Windows-Sysmon",
                    "type": [
                        "start",
                        "process_start"
                    ]
                },
                "hash": {
                    "imphash": "7c955a0abc747f57ccc4324480737ef7",
                    "md5": "04029e121a0cfa5991749937dd22a1d9",
                    "sha256": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f"
                },
                "host": {
                    "name": "CLIENT1"
                },
                "log": {
                    "level": "information"
                },
                "message": "Process Create:\nRuleName: -\nUtcTime: 2022-09-27 12:24:53.543\nProcessGuid: {0e37ca90-eb95-6332-6400-000000000400}\nProcessId: 4620\nImage: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\nFileVersion: 10.0.19041.546 (WinBuild.160101.0800)\nDescription: Windows PowerShell\nProduct: Microsoft速 Windows速 Operating System\nCompany: Microsoft Corporation\nOriginalFileName: PowerShell.EXE\nCommandLine: powershell \"$admin_secpwd = ConvertTo-SecureString 'breach' -AsPlainText -Force; $credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList 'BREACH\\Administrator', $admin_secpwd; Add-Computer -Credential $credential -DomainName 'BREACH' -Restart -Force\"\nCurrentDirectory: C:\\BREACH\\\nUser: CLIENT1\\setup\nLogonGuid: {0e37ca90-eb7f-6332-8d0f-020000000000}\nLogonId: 0x20F8D\nTerminalSessionId: 1\nIntegrityLevel: High\nHashes: MD5=04029E121A0CFA5991749937DD22A1D9,SHA256=9F914D42706FE215501044ACD85A32D58AAEF1419D404FDDFA5D3B48F66CCD9F,IMPHASH=7C955A0ABC747F57CCC4324480737EF7\nParentProcessGuid: {0e37ca90-eb94-6332-5900-000000000400}\nParentProcessId: 3808\nParentImage: C:\\Python37\\python.exe\nParentCommandLine: C:\\Python37\\python.exe \"C:\\BREACH\\init_tbf_client.py\" \nParentUser: CLIENT1\\setup",
                "process": {
                    "args": [
                        "powershell",
                        "$admin_secpwd = ConvertTo-SecureString 'breach' -AsPlainText -Force; $credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList 'BREACH\\Administrator', $admin_secpwd; Add-Computer -Credential $credential -DomainName 'BREACH' -Restart -Force"
                    ],
                    "command_line": "powershell \"$admin_secpwd = ConvertTo-SecureString 'breach' -AsPlainText -Force; $credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList 'BREACH\\Administrator', $admin_secpwd; Add-Computer -Credential $credential -DomainName 'BREACH' -Restart -Force\"",
                    "entity_id": "{0e37ca90-eb95-6332-6400-000000000400}",
                    "executable": "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
                    "hash": {
                        "md5": "04029e121a0cfa5991749937dd22a1d9",
                        "sha256": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f"
                    },
                    "name": "powershell.exe",
                    "parent": {
                        "args": [
                            "C:\\Python37\\python.exe",
                            "C:\\BREACH\\init_tbf_client.py"
                        ],
                        "command_line": "C:\\Python37\\python.exe \"C:\\BREACH\\init_tbf_client.py\" ",
                        "entity_id": "{0e37ca90-eb94-6332-5900-000000000400}",
                        "executable": "C:\\Python37\\python.exe",
                        "name": "python.exe",
                        "pid": 3808
                    },
                    "pe": {
                        "imphash": "7c955a0abc747f57ccc4324480737ef7"
                    },
                    "pid": 4620,
                    "working_directory": "C:\\BREACH\\"
                },
                "related": {
                    "hash": [
                        "04029e121a0cfa5991749937dd22a1d9",
                        "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f",
                        "7c955a0abc747f57ccc4324480737ef7"
                    ],
                    "user": "setup"
                },
                "user": {
                    "domain": "CLIENT1",
                    "name": "setup"
                },
                "winlog": {
                    "api": "wineventlog",
                    "channel": "Microsoft-Windows-Sysmon/Operational",
                    "computer_name": "CLIENT1",
                    "event_data": {
                        "Company": "Microsoft Corporation",
                        "Description": "Windows PowerShell",
                        "FileVersion": "10.0.19041.546 (WinBuild.160101.0800)",
                        "IntegrityLevel": "High",
                        "LogonGuid": "{0e37ca90-eb7f-6332-8d0f-020000000000}",
                        "LogonId": "0x20f8d",
                        "OriginalFileName": "PowerShell.EXE",
                        "ParentUser": "CLIENT1\\setup",
                        "Product": "Microsoft速 Windows速 Operating System",
                        "RuleName": "-",
                        "TerminalSessionId": "1"
                    },
                    "event_id": 1,
                    "opcode": "Info",
                    "process": {
                        "pid": 2080,
                        "thread": {
                            "id": 3584
                        }
                    },
                    "provider_guid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}",
                    "provider_name": "Microsoft-Windows-Sysmon",
                    "record_id": 914,
                    "task": "Process Create (rule: ProcessCreate)",
                    "user": {
                        "domain": "NT AUTHORITY",
                        "identifier": "S-1-5-18",
                        "name": "SYSTEM",
                        "type": "User"
                    },
                    "version": 5
                }
            }
        },
        "name": "Encoded PowerShell Command Line Usage of ConvertTo-SecureString",
        "timestamp": "2022-09-27T12:24:53.543+00:00",
        "authors": [
            "Teymur Kheirkhabarov (idea)",
            "Vasiliy Burov (rule)",
            "oscd.community",
            "Tim Shelton"
        ],
        "level": "high",
        "source": "sigma",
        "status": "experimental",
        "falsepositives": [
            "Unlikely"
        ],
        "id": "74403157-20f5-415d-89a7-c505779585cf",
        "logsource": {
            "category": "process_creation",
            "product": "windows"
        },
        "references": [
            "https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse?slide=65"
        ],
        "tags": [
            "attack.defense_evasion",
            "attack.t1027",
            "attack.execution",
            "attack.t1059.001"
        ]
    },
    {
        "total_hits": 1
    }
]